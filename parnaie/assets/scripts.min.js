'use strict';var nodes={container:document.getElementById('container'),wrapper:document.querySelector('#stripe-holder .wrapper'),content:document.getElementById('content'),title:document.getElementById('title'),word:document.getElementById('word'),type:document.getElementById('type'),def:document.getElementById('definition'),dice:document.getElementById('next'),modal:document.getElementById('modal'),aboutBtn:document.getElementById('about-bttn'),aboutContent:document.getElementById('about-content'),shareBtn:document.getElementById('share-bttn'),shareContent:document.getElementById('share-content'),shareWord:document.getElementById('share-word'),fbLink:document.getElementById('fb-link'),twLink:document.getElementById('tw-link'),gpLink:document.getElementById('gp-link')},stripesToMove=5,stripeH=document.querySelector('.stripe').offsetHeight,textEls=Array.from(nodes.title.children).map(popmotion.styler),wrapperStyler=popmotion.styler(nodes.wrapper),contentStyler=popmotion.styler(nodes.content),titleStyler=popmotion.styler(nodes.title),defStyler=popmotion.styler(nodes.def),dice=popmotion.styler(nodes.dice),modalStyler=popmotion.styler(nodes.modal),shareStyler=popmotion.styler(nodes.shareBtn),aboutStyler=popmotion.styler(nodes.aboutBtn),shareContentStyler=popmotion.styler(nodes.shareContent),aboutContentStyler=popmotion.styler(nodes.aboutContent),setModalStylers=function(a){modalStyler.set(a.modal),aboutContentStyler.set(a.about),shareContentStyler.set(a.share)},diceAnim=popmotion.tween({from:{rotate:0,borderColor:'rgba(216, 28, 35, 0.3)'},to:{rotate:360,borderColor:'rgba(255, 252, 250, 0)'},duration:600,ease:popmotion.easing.anticipate}),btnsAnim=popmotion.tween({from:{borderColor:'rgba(216, 28, 35, 0.3)'},to:{borderColor:'rgba(255, 252, 250, 0)'},duration:600,ease:popmotion.easing.anticipate});function updateDef(a){if(a.id!==state.current.id){document.title='Dic\u021Bionar de pu\u0219c\u0103rie - '+a.word,nodes.word.innerText=a.word,nodes.shareWord.innerText=a.word;var b='';for(var c in a.props)b+=a.props[c]+' ';for(nodes.type.innerText=b;nodes.def.hasChildNodes();)nodes.def.removeChild(nodes.def.lastChild);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var e,f,d=a.defs[Symbol.iterator]();!(_iteratorNormalCompletion=(e=d.next()).done);_iteratorNormalCompletion=!0)if(f=e.value,0<f.length){var g=document.createElement('li'),h=document.createTextNode(f);g.appendChild(h),nodes.def.appendChild(g)}}catch(j){_didIteratorError=!0,_iteratorError=j}finally{try{!_iteratorNormalCompletion&&d.return&&d.return()}finally{if(_didIteratorError)throw _iteratorError}}state.current=a,updateShareInfo()}}function addStripes(){for(var b,a=0;a<stripesToMove;a++)b=document.createElement('div'),b.classList.add('stripe'),nodes.wrapper.appendChild(b)}function removeStripes(){for(var a=nodes.wrapper.children,b=0;b<stripesToMove;b++)nodes.wrapper.removeChild(a[b])}function animateContent(a){addStripes();popmotion.timeline([{track:'posY',from:{y:0,opacity:1},to:{y:-(2*stripeH),opacity:0},duration:300,ease:{y:popmotion.easing.easeIn,opacity:popmotion.easing.circOut}},'-600',{track:'stripesY',from:{y:0},to:{y:-(2*stripeH)-1},duration:1e3,ease:popmotion.easing.backInOut},'-1000',{track:'posY',from:{y:titleStyler.get().translateY,opacity:0},to:{y:4*stripeH,opacity:0},ease:popmotion.easing.easeIn,duration:200},'200',{track:'posY',from:{y:titleStyler.get().translateY,opacity:0},to:{y:0,opacity:1},duration:200,ease:popmotion.easing.easeIn}]).start({update:function b(c){0===c.posY.y&&a.id!==state.current.id&&updateDef(a),contentStyler.set(c.posY),wrapperStyler.set(c.stripesY)},complete:function complete(){removeStripes(),wrapperStyler.set('y',0),window.history.pushState(a.id,null,'/'+a.id),state.status='ok'}})}var reqNext=new XMLHttpRequest;reqNext.onload=function(){if(200<=reqNext.status&&400>reqNext.status){state.status='busy';diceAnim.start({update:dice.set,complete:function complete(){animateContent(JSON.parse(reqNext.responseText))}})}else console.log('Server error')},reqNext.onerror=function(){console.log('Connection error')};var getNext=function(){'ok'===state.status&&(reqNext.open('GET','/random',!0),reqNext.send())},toggleAbout=function(){btnsAnim.start({update:aboutStyler.set,complete:function complete(){popmotion.timeline([{track:'modal',from:{y:32,opacity:0,scaleY:0},to:{y:0,opacity:1,scaleY:1},duration:250,ease:popmotion.easing.easeInOut},'-100',{track:'about',from:{y:64,opacity:0,scaleY:0},to:{y:0,opacity:1,scaleY:1},duration:400,ease:popmotion.easing.backInOut}]).start({update:setModalStylers,complete:function complete(){}})}})},toggleShare=function(){btnsAnim.start({update:shareStyler.set,complete:function complete(){popmotion.timeline([{track:'modal',from:{y:32,opacity:0,scaleY:0},to:{y:0,opacity:1,scaleY:1},duration:250,ease:popmotion.easing.easeInOut},'-100',{track:'share',from:{y:64,opacity:0,scaleY:0},to:{y:0,opacity:1,scaleY:1},duration:400,ease:popmotion.easing.backInOut}]).start({update:setModalStylers,complete:function complete(){}})}})},closeModal=function(){popmotion.timeline([{track:'share',from:{y:0,opacity:shareStyler.get().opacity,scaleY:shareStyler.get().scaleY},to:{y:64,opacity:0,scaleY:0},duration:400,ease:popmotion.easing.backInOut},'-400',{track:'about',from:{y:0,opacity:aboutStyler.get().opacity,aboutStyler:shareStyler.get().scaleY},to:{y:64,opacity:0,scaleY:0},duration:400,ease:popmotion.easing.backInOut},'-200',{track:'modal',from:{y:0,opacity:1,scaleY:1},to:{y:32,opacity:0,scaleY:0},duration:250,ease:popmotion.easing.easeInOut}]).start({update:setModalStylers})},updateShareInfo=function(){var a='http://'+window.location.host+'/'+state.current.id;nodes.fbLink.setAttribute('href','https://facebook.com/sharer/sharer.php?u='+a),nodes.twLink.setAttribute('href','https://twitter.com/intent/tweet/?text=Dictionar%20de%20puscarie%20-%20'+state.current.word+'&amp;url='+a),nodes.gpLink.setAttribute('href','https://plus.google.com/share?url='+a)};document.addEventListener('DOMContentLoaded',function(){nodes.dice.onclick=getNext,nodes.aboutBtn.onclick=toggleAbout,nodes.shareBtn.onclick=toggleShare,nodes.modal.onclick=closeModal});